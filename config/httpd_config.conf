#
# MAXIMUM PERFORMANCE OPENLITESPEED CONFIGURATION
# Optimized for WordPress with extreme speed settings
#

# Server Root
serverRoot                $SERVER_ROOT

# User/Group
user                      nobody
group                     nogroup

# Priority
priority                  0

# Enable Console
enableLVE                 0

# Logging
errorlog $SERVER_ROOT/logs/error.log {
  logLevel                WARN
  debugLevel              0
  rollingSize             10M
  enableStderrLog         1
}

accesslog $SERVER_ROOT/logs/access.log {
  rollingSize             10M
  keepDays                30
  compressArchive         1
  logFormat               "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\""
  logHeaders              5
  logRespHeader           0
  logReferer              1
  logUserAgent            1
}

# Index Files
index  {
  useServer               0
  indexFiles              index.php, index.html, index.htm
  autoIndex               0
  autoIndexURI            /_autoindex/default.php
}

# Document Root
docRoot                   $VH_ROOT/html/

# Virtual Host Templates
virtualHostTemplate centralConfigLog {
  templateFile            $SERVER_ROOT/conf/templates/ccl.conf
  listeners               Default
}

# Script Handler
scripthandler  {
  add                     lsphp82 php
}

# Rails
railsDefaults  {
  maxConns                1
  initTimeout             60
  retryTimeout            0
  pcKeepAliveTimeout      60
  respBuffer              0
  backlog                 50
  runOnStartUp            1
  extMaxIdleTime          300
  priority                3
  memSoftLimit            2047M
  memHardLimit            2047M
  procSoftLimit           1400
  procHardLimit           1500
}

# PHP
phpDefaults  {
  maxConns                35
  initTimeout             60
  retryTimeout            0
  pcKeepAliveTimeout      1
  respBuffer              0
  backlog                 100
  runOnStartUp            1
  extMaxIdleTime          300
  priority                0
  memSoftLimit            2047M
  memHardLimit            2047M
  procSoftLimit           1400
  procHardLimit           1500
}

# MAXIMUM PERFORMANCE TUNING SETTINGS
tuning  {
  maxConnections          10000
  maxSSLConnections       5000
  connTimeout             300
  maxKeepAliveReq         10000
  keepAliveTimeout        5
  sndBufSize              0
  rcvBufSize              0
  maxReqURLLen            32768
  maxReqHeaderSize        65536
  maxReqBodySize          2047M
  maxDynRespHeaderSize    32768
  maxDynRespSize          2047M
  maxCachedFileSize       4096
  totalInMemCacheSize     20M
  maxMMapFileSize         256K
  totalMMapCacheSize      40M
  useSendfile             1
  fileETag                28
  enableGzipCompress      1
  compressibleTypes       text/*, application/x-javascript, application/xml, application/javascript, image/svg+xml, application/rss+xml, application/atom_xml, image/x-ms-bmp
  enableDynGzipCompress   1
  gzipCompressLevel       6
  gzipAutoUpdateStatic    1
  gzipStaticCompressLevel 6
  brStaticCompressLevel   6
  gzipMaxFileSize         10M
  gzipMinFileSize         300

  quicEnable              1
  quicShmDir              /dev/shm
  quicVersions            h3-29,h3-Q050,h3-Q046,h3-Q043

  SSLCryptoDevice         null
  maxSSLConnections       5000
  connTimeout             300
  maxKeepAliveReq         10000
  smartKeepAlive          0
  keepAliveTimeout        5
  sndBufSize              0
  rcvBufSize              0
  gzipStaticCompressLevel 6
  brStaticCompressLevel   6
}

# Security
security  {
  fileAccessControl  {
    followSymbolLink      1
    checkSymbolLink       0
    requiredPermissionMask 000
    restrictedPermissionMask 000
  }
  perClientConnLimit      50
  CGIRLimit  {
    maxCGIInstances       20
    minUID                11
    minGID                10
    priority              0
    CPUSoftLimit          10
    CPUHardLimit          50
    memSoftLimit          1460M
    memHardLimit          1470M
    procSoftLimit         400
    procHardLimit         450
  }
  accessDenyDir  {
    dir                   /
    dir                   /etc/*
    dir                   /dev/*
    dir                   conf/*
    dir                   admin/conf/*
  }
  accessControl  {
    allow                 ALL
    deny
  }
}

# File Access Control
fileAccessControl  {
  followSymbolLink        1
  checkSymbolLink         0
  requiredPermissionMask  000
  restrictedPermissionMask 000
}

# Per Client Throttle
perClientConnLimit        50
dynReqPerSec              0
outBandwidth              0
inBandwidth               0

# CGI
CGIRLimit  {
  maxCGIInstances         20
  minUID                  11
  minGID                  10
  priority                0
  CPUSoftLimit            10
  CPUHardLimit            50
  memSoftLimit            1460M
  memHardLimit            1470M
  procSoftLimit           400
  procHardLimit           450
}

# Access Denied Directories
accessDenyDir  {
  dir                     /
  dir                     /etc/*
  dir                     /dev/*
  dir                     conf/*
  dir                     admin/conf/*
}

# Access Control
accessControl  {
  allow                   ALL
  deny
}

# Expires
expires  {
  enableExpires           1
  expiresDefault          A604800
  expiresByType           image/*=A2592000,text/css=A604800,application/x-javascript=A604800,application/javascript=A604800,font/*=A2592000,application/x-font-ttf=A2592000
}

# Cache
cache  {
  enableCache             1
  cacheStoreDir           /dev/shm/lscache
  cacheExpire             86400
  cacheMaxObjSize         10000000
  cacheStale              200
  cacheCheckPrivateCache  1
  cacheCheckPublicCache   1
  cacheMaxEntries         10000
  cacheKeyMod             0
  cacheVaryByValue        0
}

# IP to GeoLocation
ipToGeo  {
  GEOIP_DB_FILE           conf/GeoLiteCity.dat
  GEOIP_DB_CACHE          0
}

# Listeners
listener Default {
  address                 *:80
  secure                  0
  map                     * $VH_ROOT/
}

listener SSL {
  address                 *:443
  secure                  1
  keyFile                 /usr/local/lsws/conf/example.key
  certFile                /usr/local/lsws/conf/example.crt
  certChain               1
  caCertPath              /etc/ssl/certs/
  caCertFile              /etc/ssl/certs/ca-certificates.crt
  clientVerify            0
  verifyDepth             9
  crlPath
  crlFile
  ciphers                 EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:AES256+EECDH:AES256+EDH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK
  enableECDHE             1
  renegProtection         1
  sslSessionCache         1
  sslSessionTickets       1
  enableSpdy              15
  enableQuic              1
  map                     * $VH_ROOT/
}

# Virtual Hosts
virtualhost $VH_NAME {
  vhRoot                  $VH_ROOT
  configFile              $VH_ROOT/vhconf.conf
  allowSymbolLink         1
  enableScript            1
  restrained              0
  setUIDMode              0
}

# Modules
module cache {
  internal                1
  priority                0
  maxConns                35
  env                     LSCACHE_VARY_COOKIE=_lscache_vary
  env                     LSCACHE_VARY_VALUE=
  
  param                   enableCache 1
  param                   cacheStoreDir /dev/shm/lscache
  param                   cacheExpire 86400
  param                   cacheMaxObjSize 10000000
  param                   cacheStale 200
  param                   cacheCheckPrivateCache 1
  param                   cacheCheckPublicCache 1
  param                   cacheMaxEntries 10000
  param                   cacheKeyMod 0
  param                   cacheVaryByValue 0
}
