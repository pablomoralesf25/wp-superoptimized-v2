docRoot                   $VH_ROOT/html
vhDomain                 localhost
adminEmails              admin@localhost

# MAXIMUM PERFORMANCE OPTIMIZATIONS
enableGzip               1
enableBr                 1
enableIpGeo              0

# Advanced compression settings for maximum speed
compressibleTypes        text/*, application/javascript, application/json, application/xml, application/rss+xml, application/atom+xml, image/svg+xml
gzipCompressLevel        6
brotliCompressLevel      6

# HTTP/2 and HTTP/3 optimizations
enableHttp2              1
enableQuic               1

# Connection optimizations
maxConnections           10000
maxSSLConnections        5000
connTimeout              300
maxKeepAliveReq          10000
keepAliveTimeout         5

# Cache optimizations
enableCache              1
cacheStorePath           /tmp/lshttpd/cache
cacheMaxObjSize          10000000
cacheExpire              86400
cacheStale               200

# Static file optimizations
enableExpires            1
expiresDefault           A604800
expiresByType            image/*=A2592000, text/css=A604800, application/javascript=A604800

# Security Headers
context / {
    location                $DOC_ROOT
    allowBrowse             1
    addDefaultCharset       utf-8
    
    # Reduced Security Headers for better performance
    addHeader    Strict-Transport-Security "max-age=31536000"
    addHeader    X-Content-Type-Options nosniff
    addHeader    X-Frame-Options SAMEORIGIN
    
    # Disable PHP execution in uploads directory
    context /wp-content/uploads {
        location            $DOC_ROOT/wp-content/uploads
        allowBrowse         1
        addDefaultCharset   utf-8
        rewrite  {
          enable           0
        }
        phpIniOverride  {
          php_admin_flag   engine off
        }
    }

    # Protect wp-config.php
    context /wp-config.php {
        allowBrowse         0
        deny               from all
    }

    # Protect .htaccess
    context /.htaccess {
        allowBrowse         0
        deny               from all
    }

    # Block access to debug log files
    context ~ /wp-content/debug.log {
        deny               from all
    }

    # WordPress rewrite rules
    rewrite  {
        enable              1
        inherit            1
        rules              <<<END
            rewriteEngine On
            rewriteBase /
            
            # WordPress standard rules
            RewriteRule ^index\.php$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.php [L]
        END
    }
}

# Optimized wp-admin area (much less restrictive)
context /wp-admin {
    location                $DOC_ROOT/wp-admin
    allowBrowse             1
    
    # Relaxed rate limiting for wp-admin
    accessControl  {
        allow               0.0.0.0/0
        
        # MUCH more lenient limits
        perClientConnLimit      50      # Increased from 10 to 50
        gracePeriod            60       # Increased from 15 to 60 seconds
        banPeriod              60       # Reduced from 300 to 60 seconds
    }
    
    rewrite  {
        enable               1
        inherit             1
    }
}

# Allow XML-RPC for legitimate use (but with basic protection)
context /xmlrpc.php {
    location                $DOC_ROOT/xmlrpc.php
    allowBrowse             1
    
    # Basic rate limiting for XML-RPC
    accessControl  {
        allow               0.0.0.0/0
        perClientConnLimit      20
        gracePeriod            30
        banPeriod              120
    }
}

# Block access to sensitive files
context ~ \.(ini|log|conf|env)$ {
    deny                from all
}

# Block PHP execution in uploads
context /wp-content/uploads/.*.php$ {
    deny                from all
}

# Custom error pages
errorpage 404 {
    url                 /404.html
}

errorpage 403 {
    url                 /403.html
}

# Reduced Security settings
securityHeaders {
    enable              1
    xssProtection      "1; mode=block"
    xFrameOptions      SAMEORIGIN
    hstsEnabled        1
    hstsMaxAge         31536000
    hstsIncludeSubDomains 0     # Disabled for better performance
    hstsPreload        0        # Disabled for better performance
}

# ModSecurity settings - DISABLED for performance
module mod_security {
    enable              0       # DISABLED - Major performance impact
    # logLevel           5
    # debugLogLevel      3
    # ruleEngine         On
    # auditEngine        On
} 